const { createApp } = Vue; 

createApp({

    data() {

        return{

            activeContact: 0,
            lastAccess: "00:00",
            inputMessage: "",
            inputSearch: "",
            contacts: [
                {
                    name: 'Michele',
                    avatar: '_1',
                    visible: true,
                    messages: [
                        {
                            date: '10/01/2020 15:30:55',
                            message: 'Hai portato a spasso il cane?',
                            status: 'sent'
                        },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Ricordati di dargli da mangiare',
                            status: 'sent'
                        },
                        {
                            date: '10/01/2020 16:15:22',
                            message: 'Tutto fatto!',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Fabio',
                    avatar: '_2',
                    visible: true,
                    messages: [{
                        date: '20/03/2020 16:30:00',
                        message: 'Ciao come stai?',
                        status: 'sent'
                    },
                        {
                            date: '20/03/2020 16:30:55',
                            message: 'Bene grazie! Stasera ci vediamo?',
                            status: 'received'
                        },
                        {
                            date: '20/03/2020 16:35:00',
                            message: 'Mi piacerebbe ma devo andare a fare la spesa.',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Samuele',
                    avatar: '_3',
                    visible: true,
                    messages: [{
                        date: '28/03/2020 10:10:40',
                        message: 'La Marianna va in campagna',
                        status: 'received'
                    },
                        {
                            date: '28/03/2020 10:20:10',
                            message: 'Sicuro di non aver sbagliato chat?',
                            status: 'sent'
                        },
                        {
                            date: '28/03/2020 16:15:22',
                            message: 'Ah scusa!',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Alessandro B.',
                    avatar: '_4',
                    visible: true,
                    messages: [{
                        date: '10/01/2020 15:30:55',
                        message: 'Lo sai che ha aperto una nuova pizzeria?',
                        status: 'sent'
                    },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Si, ma preferirei andare al cinema',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Alessandro L.',
                    avatar: '_5',
                    visible: true,
                    messages: [{
                        date: '10/01/2020 15:30:55',
                        message: 'Lo sai che ha aperto una nuova pizzeria?',
                        status: 'sent'
                    },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Si, ma preferirei andare al cinema',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Claudia',
                    avatar: '_6',
                    visible: true,
                    messages: [{
                        date: '10/01/2020 15:30:55',
                        message: 'Lo sai che ha aperto una nuova pizzeria?',
                        status: 'sent'
                    },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Si, ma preferirei andare al cinema',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Federico',
                    avatar: '_7',
                    visible: true,
                    messages: [{
                        date: '10/01/2020 15:30:55',
                        message: 'Lo sai che ha aperto una nuova pizzeria?',
                        status: 'sent'
                    },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Si, ma preferirei andare al cinema',
                            status: 'received'
                        }
                    ],
                },
                {
                    name: 'Davide',
                    avatar: '_8',
                    visible: true,
                    messages: [{
                        date: '10/01/2020 15:30:55',
                        message: 'Lo sai che ha aperto una nuova pizzeria?',
                        status: 'sent'
                    },
                        {
                            date: '10/01/2020 15:50:00',
                            message: 'Si, ma preferirei andare al cinema',
                            status: 'received'
                        }
                    ],
                },
            ],

        }

    },

    methods:{

        // Funzione che aggiunge la classe active al contatto attivo
        setActiveClass(index){
            if (this.activeContact == index) {
                this.changeLastAccess();
                return 'active';
            }
            else{
                return '';
            }
        },

        // Funzione che recupera l'ora dell'ultimo accesso
        changeLastAccess(){
            for(let i=0;i<this.contacts[this.activeContact].messages.length;i++){
                if(this.contacts[this.activeContact].messages[i].status=="received"){
                    this.lastAccess=this.contacts[this.activeContact].messages[i].date.substring(11,16);
                }
            }
        },

        // Funzione che assegna la classe active al click
        changeActiveClass(index){
            this.activeContact = index;
            this.changeLastAccess();
        },

        // Messaggio di risposta all'input dell'utente
        answerMessage(){
            this.contacts[this.activeContact].messages.push({
                date: '10/01/2020 21:32:55',
                message: "Ok",
                status: 'received',
            });
        },

        // Funzione che permette di inviare il messaggio di input
        submitMessage(){
            this.contacts[this.activeContact].messages.push({
                date: '10/01/2020 21:30:55',
                message: this.inputMessage,
                status: 'sent'
            });

            this.inputMessage = "";
            setTimeout(this.answerMessage, 1000);
        
        },

        // Funzione per la ricerca dei contatti  
        searchContact(name){
    
            let check = true;

            for (let index = 0; index < this.inputSearch.length; index++) {
                if(this.inputSearch[index]!=name[index]){
                    check = false;
                }
            }

            if (!check){
                return "wrong-contact";
            }
            else{
                return "";
            }
            
        }
    }


}).mount("#app");

